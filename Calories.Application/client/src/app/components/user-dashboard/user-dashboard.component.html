<div class="dashboard-container">
  <h2>Welcome {{ user?.userName || "anonymous" }}</h2>
  <h3>Daily target: {{ user?.expectedCaloriesPerDay || 0 }}kcal</h3>
  @if (isFiltered()) {
  <div class="calories-display neutral">
    <h3>Filtered calories: {{ filteredCalories() }}kcal</h3>
  </div>
  } @else {
  <div class="calories-display" [ngClass]="getCaloriesStatus()">
    <h3>Calories today: {{ totalCalories() }}kcal</h3>
    <p class="calories-info">
      @if (getCaloriesStatus() === 'under') { Within daily target } @else if
      (getCaloriesStatus() === 'over') { Above daily target }
    </p>
  </div>
  }

  <div class="actions">
    <button (click)="openCreateMealModal()" class="main-btn">Add Meal</button>
    <button (click)="openEditUserModal()" class="main-btn">Edit User</button>
  </div>

  <div class="filter-container">
    <div class="filter-header">
      <h4 class="filter-title">Filter Meals</h4>
      @if (hasActiveFilters()) {
      <button class="main-btn" (click)="clearFilters()">Clear Filters</button>
      }
    </div>

    <div class="filter-groups">
      <div class="filter-group">
        <label for="fromDate">From Date</label>
        <input
          type="date"
          id="fromDate"
          [(ngModel)]="filter.fromDate"
          (ngModelChange)="loadMeals()"
        />
      </div>

      <div class="filter-group">
        <label for="toDate">To Date</label>
        <input
          type="date"
          id="toDate"
          [(ngModel)]="filter.toDate"
          (ngModelChange)="loadMeals()"
        />
      </div>

      <div class="filter-group">
        <label for="fromTime">From Time</label>
        <input
          type="time"
          id="fromTime"
          [(ngModel)]="filter.fromTime"
          (ngModelChange)="loadMeals()"
        />
      </div>

      <div class="filter-group">
        <label for="toTime">To Time</label>
        <input
          type="time"
          id="toTime"
          [(ngModel)]="filter.toTime"
          (ngModelChange)="loadMeals()"
        />
      </div>
    </div>
  </div>

  <app-meals-list
    [meals]="meals()"
    (deleteMeal)="deleteMeal($event)"
    (mealEdited)="loadMeals()"
  ></app-meals-list>
</div>

<app-create-meal-modal
  [isOpen]="isModalOpen"
  [mealModel]="mealModel"
  (save)="saveCreateMeal($event)"
  (close)="closeCreateMealModal()"
></app-create-meal-modal>

<app-edit-user-by-user-modal
  [isOpen]="isEditUserModalOpen"
  [editUserModel]="editUserModel"
  (close)="closeEditUserModal()"
  (save)="updateUser($event)"
></app-edit-user-by-user-modal>
